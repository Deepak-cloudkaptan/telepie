BEGIN { 
    ENUM="\tpublic enum Element {\n\t\t"; REGEXP=""; TOTAL=0; RECORD=1; COUNT=0; 

}
function regExpLine(name, len, type, static) { 
    if (type != "S") {
        return "\n\t\t+ \"(?<\"+ Element." name ".name() + \">.{" len "})\""; 
    } else {
        return "\n\t\t+ \"(?<\"+ Element." name ".name() + \">" static ")\"";
    }
}
function regExpStartLine(name, len, type, static) { 
    if (type != "S") {
        return "\"^(?<\"+ Element." name ".name() + \">.{" len "})\""; 
    } else {
        return "\"^(?<\"+ Element." name ".name() + \">" static ")\"";    
    }
}

{ 
    if (RECORD == 1) {
        RECORD = 2;
        CHECKTOTAL=$1;
    } else if (RECORD == 2) {
        RECORD = 3;
        ENUM = ENUM $1;
        REGEXP = regExpStartLine($1, $2, $3, $4)
    } else {
        COUNT = COUNT + 1;
        ENUM = ENUM ", ";
        if (COUNT == 3) {
            ENUM = ENUM "\n\t\t";
            COUNT=0;
        }
        REGEXP = REGEXP regExpLine($1, $2, $3, $4);
        ENUM = ENUM $1;
    }
    REGEXP = REGEXP "";
    TOTAL=TOTAL+$2;
}
END { 
    if (TOTAL == CHECKTOTAL) {
        split(FILENAME,name,".");
        print "\t/* Generated by makeBetforData.sh */";
        print "\tprivate static Log log = LogFactory.getLog(" name[1] ".class);"
        if (FILENAME != "BetforHeader.layout") {
            print "\tprivate static String betforRegexp = " REGEXP "\n\t\t+ \"$\";";
        } else {
            print "\tprivate static String betforRegexp = " REGEXP ";";
        }
        print "\tpublic static Pattern betforPattern = Pattern.compile(betforRegexp);"
        print "\tMatcher m;\n" ENUM "\n\t}"; 
    } else {
            print "\t// Total length of elements in " FILENAME " is " TOTAL " not " CHECKTOTAL " as it should "
    }
}
